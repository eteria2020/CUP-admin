<h4>Esegui comandi sull'auto</h4>

<?php echo $this->partial('partials/flash-messages.phtml', []); ?>

<div class="btn-group">
    <button type="button" class="btn btn-default"><?= $this->translate("Seleziona..."); ?></button>
    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><i class="fa fa-angle-down"></i></button>
    <ul class="dropdown-menu" role="menu" id="menu">
        <?php foreach ($this->commands as $key => $command): ?>
            <li>
                <a onclick="callController(<?= $key ?>)">
                    <?= $command; ?>
                </a>
            </li>
        <?php endforeach; ?>
    </ul>
</div>

<?php

function abcfd() {
    
}
?>


<script>

    
    var callController = function (key) {
        var RFID = null;
        var plate = "<?= $this->car->getPlate(); ?>";
        console.log("click comando");
        if (key == 13) {
            console.log("selezionato apri porte");
            if(<?= $this->nTripOpen ?> == 0){
                console.log("non ci sono altre corse");
                var txt_message = prompt("Inserire RFID", "");
                RFID = txt_message;
                if(RFID != null){
                    $.ajax({
                        url: "/cars/send-command/" +plate+ "/" +key+ "/"+RFID,
                    });
                }
            }else{
                console.log("corse aperte nonc chiamata");
                alert("Per questa targa Ã¨ presente una corsa ancora aperta");
            }
        }else{
            console.log("altro comando");
            if(confirm('<?= $this->translate("Sei sicuro di voler eseguire questo comando?"); ?>')){
                console.log("commando passa");
                $.ajax({
                    url: "/cars/send-command/" +plate+ "/" +key,
                });
            }else{
                console.log("comando annullato");
            }
        }
        console.log("fine");
    }

</script>